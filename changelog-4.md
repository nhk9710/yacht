# Changelog #4: UI 리디자인 — Top View 카메라, 주사위 결과 숫자, 레이아웃 개선, 플레이어 점수 팝업

## 날짜
2026-02-11

## 변경 사유
사용자 피드백 4건 반영:

1. **테이블을 Top View 시점**으로 보고 싶다
2. **주사위 결과를 숫자**로 표시해달라
3. **하단 UI 개선** — 굴리기 버튼/주사위 결과를 점수표 상단에, 플레이어 점 표시를 이름 뱃지로 교체
4. **플레이어 이름표 클릭 시 점수표 팝업**으로 해당 플레이어 현재 점수 확인

---

## 수정 파일 (6개)

### 1. `client/src/components/three/GameScene.vue` — 카메라 Top View 전환

#### 카메라 위치 변경
```
변경 전: camera.position.set(0, 8, 8)   // 45도 각도 사선 뷰
변경 후: camera.position.set(0, 12, 0.01) // 수직 Top-down 뷰
```
- Y=12에서 거의 수직으로 내려다보는 시점
- Z=0.01로 설정하여 lookAt 방향 벡터가 정의되도록 보장
- 테이블 전체와 주사위가 한눈에 보이는 레이아웃

#### 조명 위치 조정
```
변경 전: dirLight.position.set(5, 10, 5)
변경 후: dirLight.position.set(3, 12, 3)
```
- Top-down 뷰에서 그림자가 자연스럽게 보이도록 조명도 상단으로 이동

#### 카메라 흔들림 조정
- 기존: X축 흔들림만 (사선 뷰용)
- 변경: X/Z 모두 미세 흔들림 (top-down에서 생동감)

---

### 2. `client/src/views/GameView.vue` — 전체 레이아웃 리디자인

#### 변경 전 레이아웃
```
┌──────────────────────────────────────────────┐
│  [턴 정보] [라운드] [굴림] ●●●●● (색상 점)  │  ← 상단 바
├──────────────────────┬───────────────────────┤
│                      │                       │
│    3D 주사위 장면     │      점수표           │
│                      │                       │
├──────────────────────┴───────────────────────┤
│  [⚀⚁⚂⚃⚄] [주사위 굴리기] [●이름 ●이름 ...] │  ← 하단 바
└──────────────────────────────────────────────┘
```

#### 변경 후 레이아웃
```
┌──────────────────────────────────────────────┐
│  [턴 정보] [라운드] [굴림]  [●이름][●이름].. │  ← 상단 바 (뱃지가 우측으로 이동)
├──────────────────────┬───────────────────────┤
│                      │ [1][3][5][2][4] 합:19 │  ← 주사위 결과 (숫자)
│                      │ [  주사위 굴리기  ]   │  ← 굴리기 버튼
│    3D 주사위 장면     ├──────────────────────┤
│                      │                       │
│    (Top View)        │      점수표           │
│                      │                       │
└──────────────────────┴───────────────────────┘
```

#### 주요 변경점

**상단 바**:
- 우측의 색상 점(●●●●●) → **색상 + 이름 뱃지**로 교체
- 뱃지는 클릭 가능 (다른 플레이어 점수 조회)
- 현재 턴 플레이어 뱃지에 accent 테두리 강조

**하단 바 제거**:
- 기존 하단 바(dice-selector, roll-button, player-bar) 완전 삭제
- 모든 컨트롤이 우측 패널 상단으로 이동

**우측 패널 상단 (controls-area)**:
- 주사위 결과: 숫자(1~6)로 표시되는 36px 칩 5개 + 합계
- 칩 클릭으로 주사위 유지(keep) 토글 가능
- 유지된 주사위는 accent 테두리 + 하단 점 표시
- 합계는 우측에 구분선과 함께 표시
- 그 아래 굴리기 버튼 (전체 너비)

**하단 바 → 우측 패널로 이동한 이유**:
- Top-down 뷰에서는 3D 장면 아래 공간이 불필요
- 주사위 결과와 점수표가 같은 영역에 있어 점수 선택이 직관적
- 화면 세로 공간을 더 효율적으로 활용

---

### 3. `client/src/components/ui/PlayerScorePopup.vue` — 신규 컴포넌트

플레이어 이름 뱃지 클릭 시 나타나는 점수표 팝업.

**구성**:
- 오버레이(반투명 배경) + 가운데 카드
- 헤더: 플레이어 색상 점 + 이름 + 닫기 버튼
- 본문: ScoreCard.vue와 동일한 점수표 구조 (Upper/Lower/Subtotal/Bonus/Total)
- 로딩 상태: 스피너 + "불러오는 중..." 텍스트

**인터랙션**:
- 오버레이 클릭으로 닫기
- 닫기 버튼(✕)으로 닫기
- fade-in + slide-up 애니메이션

**데이터 플로우**:
```
뱃지 클릭 → socket.emit('score:request', { playerId })
         → 서버가 해당 플레이어 점수표 조회
         → socket.emit('score:player', data)
         → store.viewingPlayerScore에 저장
         → 팝업에 표시
```

---

### 4. `server/src/GameRoom.js` — 플레이어 점수 조회 메서드 추가

```javascript
getPlayerScoreCardById(playerId)
```
- 기존 `getPlayerScoreCard(socketId)`와 유사하나, 다른 플레이어 점수 조회용
- 반환값에 `playerId`, `name`, `color` 포함 (팝업 헤더 표시용)

---

### 5. `server/src/index.js` — 점수 요청 소켓 이벤트 추가

```javascript
socket.on('score:request', ({ playerId }) => { ... })
```
- 게임 진행 중(playing)이거나 종료(finished) 상태에서만 조회 가능
- 요청자에게만 `score:player` 이벤트로 응답 (다른 플레이어에게 브로드캐스트하지 않음)

---

### 6. `client/src/stores/gameStore.ts` + `client/src/composables/useSocket.ts`

**Store 추가**:
- `viewingPlayerScore`: 현재 조회 중인 다른 플레이어의 점수 데이터
- `setViewingPlayerScore()`: 서버 응답 수신 시 저장
- `clearViewingPlayerScore()`: 팝업 닫을 때 초기화

**Socket 추가**:
- `requestPlayerScore(playerId)`: 서버에 점수 요청 emit
- `score:player` 이벤트 리스너: 응답을 store에 저장

---

## 변경 전후 비교

| 항목 | 변경 전 | 변경 후 |
|------|---------|---------|
| 카메라 시점 | 45도 사선 뷰 (Y=8, Z=8) | Top-down 수직 뷰 (Y=12) |
| 주사위 결과 표시 | 유니코드 주사위(⚀-⚅) | 숫자(1-6) + 합계 |
| 결과 위치 | 하단 바 좌측 | 점수표 상단 (우측 패널) |
| 굴리기 버튼 위치 | 하단 바 중앙 | 점수표 상단 (우측 패널) |
| 플레이어 표시 (상단) | 10px 색상 점 | 색상 + 이름 뱃지 |
| 플레이어 표시 (하단) | 색상 + 이름 칩 | 제거 (상단으로 통합) |
| 하단 바 | 존재 | 제거 |
| 다른 플레이어 점수 | 조회 불가 | 이름 클릭 → 팝업 |

---

## 신규 소켓 이벤트

| 이벤트 | 방향 | 데이터 |
|--------|------|--------|
| `score:request` | Client → Server | `{ playerId: string }` |
| `score:player` | Server → Client | `{ playerId, name, color, scores, bonus, total }` |
